<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø´Ø·Ø±Ù†Ø¬ Ø¶Ø¯ AI Ù‚ÙˆÙŠ Ø¬Ø¯Ù‹Ø§</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0-beta.6/chess.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>
  <script src="https://unpkg.com/stockfish@16/src/stockfish.wasm.js"></script>
  <style>
    body { background:#000; color:#fff; text-align:center; font-family:Arial; padding:10px; margin:0; }
    h1 { font-size:24px; margin:10px; }
    #board { width:95vw; max-width:500px; margin:20px auto; }
    button { padding:15px 30px; font-size:20px; margin:10px; background:#0066ff; color:#fff; border:none; border-radius:10px; cursor:pointer; }
    #status { font-size:22px; margin:20px; font-weight:bold; }
    #loading { color:#ff0; font-size:18px; margin:20px; }
  </style>
</head>
<body>
  <h1>â™Ÿï¸ Ø´Ø·Ø±Ù†Ø¬ Ø¶Ø¯ AI Ù‚ÙˆÙŠ Ø¬Ø¯Ù‹Ø§ Ø¬Ø¯Ù‹Ø§ â™Ÿï¸</h1>
  <p>Stockfish - Ø£Ù‚ÙˆÙ‰ Ù…Ø­Ø±Ùƒ Ø´Ø·Ø±Ù†Ø¬ ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… (ØµØ¹Ø¨ Ø¹Ù„Ù‰ Ø£ÙŠ Ø¨Ø´Ø±!)</p>
  <div id="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€AI... Ø«ÙˆØ§Ù†ÙŠ Ø¨Ø³ (Ø£ÙˆÙ„ Ù…Ø±Ø©)</div>
  <div id="board" style="display:none;"></div>
  <button onclick="startAsWhite()">Ø§Ù„Ø¹Ø¨ Ø£Ø¨ÙŠØ¶ (Ø£Ù†Øª ØªØ¨Ø¯Ø£)</button>
  <button onclick="startAsBlack()">Ø§Ù„Ø¹Ø¨ Ø£Ø³ÙˆØ¯ (AI ÙŠØ¨Ø¯Ø£)</button>
  <button onclick="newGame()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
  <div id="status">Ø§Ø¶ØºØ· Ø²Ø± Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©</div>

  <script>
    const game = new Chess();
    let board = null;
    let engine = null;
    let playerColor = 'w';

    // ØªØ­Ù…ÙŠÙ„ Stockfish
    engine = STOCKFISH();
    engine.onmessage = (event) => {
      const line = event.data || event;
      if (line.includes('bestmove')) {
        const move = line.split(' ')[1];
        if (move && move !== '(none)') {
          game.move(move);
          board.position(game.fen());
          updateStatus();
          document.getElementById('loading').style.display = 'none';
        }
      }
    };

    engine.postMessage('uci');
    engine.postMessage('setoption name Skill Level value 20');
    engine.postMessage('setoption name Threads value 4');
    engine.postMessage('ucinewgame');
    engine.postMessage('isready');

    const config = {
      draggable: true,
      position: 'start',
      onDrop: (source, target) => {
        const move = game.move({
          from: source,
          to: target,
          promotion: 'q'
        });
        if (move === null) return 'snapback';
        updateStatus();
        aiTurn();
      }
    };

    function initBoard() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('board').style.display = 'block';
      if (board) board.destroy();
      board = Chessboard('board', config);
      board.position(game.fen());
    }

    function aiTurn() {
      if (game.game_over()) {
        updateStatus();
        return;
      }
      document.getElementById('loading').textContent = 'Ø§Ù„Ù€AI Ø¨ÙŠØ­Ø³Ø¨ Ø­Ø±ÙƒØ© Ù‚ÙˆÙŠØ© Ø¬Ø¯Ù‹Ø§...';
      document.getElementById('loading').style.display = 'block';
      engine.postMessage('position fen ' + game.fen());
      engine.postMessage('go depth 30'); // ØµØ¹ÙˆØ¨Ø© Ù…Ø¬Ù†ÙˆÙ†Ø©
    }

    function updateStatus() {
      let status = '';
      if (game.in_checkmate()) {
        status = game.turn() === playerColor ? 'ÙƒØ´ Ù…Ø§Øª! Ø®Ø³Ø±Øª ğŸ˜­' : 'ÙƒØ´ Ù…Ø§Øª! ÙØ²Øª ğŸ‰';
      } else if (game.in_draw()) {
        status = 'ØªØ¹Ø§Ø¯Ù„ ğŸ¤';
      } else {
        status = game.turn() === 'w' ? 'Ø¯ÙˆØ± Ø§Ù„Ø£Ø¨ÙŠØ¶' : 'Ø¯ÙˆØ± Ø§Ù„Ø£Ø³ÙˆØ¯';
      }
      document.getElementById('status').innerText = status;
    }

    function startAsWhite() {
      playerColor = 'w';
      newGame();
    }

    function startAsBlack() {
      playerColor = 'b';
      newGame();
      aiTurn();
    }

    function newGame() {
      game.reset();
      initBoard();
      updateStatus();
    }

    // Ø§Ø¨Ø¯Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Stockfish
    setTimeout(() => {
      initBoard();
      startAsWhite();
    }, 4000);
  </script>
</body>
</html>
