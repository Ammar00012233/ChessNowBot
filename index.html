<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø´Ø·Ø±Ù†Ø¬ Ø§Ù„Ù…Ø­ØªØ±ÙÙŠÙ† Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <style>
        :root { --light: #f0d9b5; --dark: #b58863; --accent: #27ae60; --bg: #121212; --panel: #1e1e1e; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: white; margin: 0; overflow: hidden; }

        /* Ø§Ù„ØµÙØ­Ø§Øª */
        .page { display: none; height: 100vh; width: 100vw; flex-direction: column; align-items: center; justify-content: center; position: absolute; top: 0; left: 0; }
        .active { display: flex; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .menu-btn { background: var(--panel); border: 2px solid var(--accent); color: white; padding: 20px; margin: 10px; width: 80%; max-width: 300px; border-radius: 15px; font-size: 1.2rem; cursor: pointer; transition: 0.3s; font-weight: bold; }
        .menu-btn:hover { background: var(--accent); transform: translateY(-3px); }

        /* Ø§Ù„Ù„ÙˆØ­Ø© */
        #board { display: grid; grid-template-columns: repeat(8, 1fr); width: 95vw; max-width: 380px; border: 4px solid #333; }
        .square { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        .square.light { background: var(--light); }
        .square.dark { background: var(--dark); }
        .square img { width: 90%; height: 90%; pointer-events: none; }
        .hint::after { content: ""; width: 30%; height: 30%; background: rgba(34, 139, 34, 0.6); border-radius: 50%; position: absolute; }
        .selected { background: rgba(255, 255, 0, 0.5) !important; }

        /* Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ */
        .stats-container { background: var(--panel); padding: 20px; border-radius: 20px; width: 85%; max-width: 350px; }
        .stat-row { display: flex; justify-content: space-around; margin: 20px 0; }
        .stat-item { display: flex; flex-direction: column; }
        .stat-val { font-size: 1.8rem; font-weight: bold; color: var(--accent); }

        /* Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØµÙˆØª */
        .audio-ctrl { position: fixed; top: 15px; left: 15px; background: var(--panel); padding: 10px; border-radius: 50%; cursor: pointer; z-index: 1000; border: 1px solid var(--accent); }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
        .back-btn { position: fixed; top: 15px; right: 15px; background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; flex-direction: column; justify-content: center; align-items: center; }
    </style>
</head>
<body>

    <!-- Ù…ÙˆØ³ÙŠÙ‚Ù‰ ÙˆØ£ØµÙˆØ§Øª -->
    <audio id="bgMusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-16.mp3" type="audio/mpeg">
    </audio>
    <audio id="moveSnd" src="https://images.chesscomfiles.com/chess-themes/sounds/_MP3_/default/move-self.mp3"></audio>

    <!-- Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØµÙˆØª -->
    <div class="audio-ctrl" onclick="toggleMusic()" id="musicBtn">ğŸµ</div>

    <!-- 1. Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="page-home" class="page active">
        <h1 style="color:var(--accent); font-size: 2.5rem; margin-bottom: 30px;">Ø´Ø·Ø±Ù†Ø¬ Ø¨Ø±Ùˆ</h1>
        <button class="menu-btn" onclick="startGame('ai')">ğŸ¤– Ù„Ø§Ø¹Ø¨ Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</button>
        <button class="menu-btn" onclick="startGame('friend')">ğŸ‘¥ Ù„Ø§Ø¹Ø¨ Ø¶Ø¯ ØµØ¯ÙŠÙ‚</button>
        <button class="menu-btn" onclick="showProfile()" style="border-color:#3498db;">ğŸ‘¤ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠ</button>
    </div>

    <!-- 2. ØµÙØ­Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
    <div id="page-game" class="page">
        <button class="back-btn" onclick="goHome()">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
        <h3 id="game-mode-title">Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</h3>
        <div id="status" style="color:var(--accent); font-weight:bold; margin-bottom:10px;">Ø¯ÙˆØ±: Ø§Ù„Ø£Ø¨ÙŠØ¶</div>
        <div id="board"></div>
        <p style="font-size: 0.8rem; margin-top:10px; color:#888;">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø·Ø¹Ø© Ø«Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø¯Ù</p>
    </div>

    <!-- 3. ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ -->
    <div id="page-profile" class="page">
        <button class="back-btn" onclick="goHome()">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
        <div class="stats-container">
            <h2>Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙŠ</h2>
            <div class="stat-row">
                <div class="stat-item"><span id="w-val" class="stat-val">0</span><span>ÙÙˆØ²</span></div>
                <div class="stat-item"><span id="l-val" class="stat-val">0</span><span>Ø®Ø³Ø§Ø±Ø©</span></div>
                <div class="stat-item"><span id="d-val" class="stat-val">0</span><span>ØªØ¹Ø§Ø¯Ù„</span></div>
            </div>
            <hr style="border:0.5px solid #333">
            <button onclick="clearStats()" style="background:none; color:#e74c3c; cursor:pointer; border:none; margin-top:10px;">ØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -->
    <div id="overlay">
        <h1 id="overTitle" style="color:#ff4444">Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¬ÙŠÙ…</h1>
        <p id="overDesc" style="font-size: 1.2rem; margin-bottom:20px;"></p>
        <button class="menu-btn" onclick="goHome()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    </div>

    <script>
        const game = new Chess();
        const boardEl = document.getElementById('board');
        let selectedSquare = null;
        let gameMode = 'ai'; // 'ai' or 'friend'
        let isMuted = false;

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø© ---
        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
        }

        function startGame(mode) {
            gameMode = mode;
            game.reset();
            document.getElementById('game-mode-title').innerText = mode === 'ai' ? 'ğŸ¤– Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±' : 'ğŸ‘¥ Ø¶Ø¯ ØµØ¯ÙŠÙ‚';
            showPage('game');
            createBoard();
            updateStatus();
            // Ø¨Ø¯Ø¡ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ØªÙØ§Ø¹Ù„
            if(!isMuted) document.getElementById('bgMusic').play().catch(()=>{});
        }

        function showProfile() {
            loadStats();
            showPage('profile');
        }

        function goHome() {
            document.getElementById('overlay').style.display = 'none';
            showPage('home');
        }

        // --- Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØµÙˆØª ---
        function toggleMusic() {
            const music = document.getElementById('bgMusic');
            isMuted = !isMuted;
            if (isMuted) {
                music.pause();
                document.getElementById('musicBtn').innerText = 'ğŸ”‡';
            } else {
                music.play();
                document.getElementById('musicBtn').innerText = 'ğŸµ';
            }
        }

        // --- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ---
        function updateStats(res) {
            let s = JSON.parse(localStorage.getItem('ch_st')) || {w:0, l:0, d:0};
            if(res === 'win') s.w++; else if(res === 'loss') s.l++; else s.d++;
            localStorage.setItem('ch_st', JSON.stringify(s));
        }

        function loadStats() {
            let s = JSON.parse(localStorage.getItem('ch_st')) || {w:0, l:0, d:0};
            document.getElementById('w-val').innerText = s.w;
            document.getElementById('l-val').innerText = s.l;
            document.getElementById('d-val').innerText = s.d;
        }

        function clearStats() { if(confirm("Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªØŸ")) { localStorage.removeItem('ch_st'); loadStats(); } }

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ø´Ø·Ø±Ù†Ø¬ ---
        const pieces = {
            'p': 'https://chessboardjs.com/img/chesspieces/wikipedia/bP.png','r': 'https://chessboardjs.com/img/chesspieces/wikipedia/bR.png','n': 'https://chessboardjs.com/img/chesspieces/wikipedia/bN.png','b': 'https://chessboardjs.com/img/chesspieces/wikipedia/bB.png','q': 'https://chessboardjs.com/img/chesspieces/wikipedia/bQ.png','k': 'https://chessboardjs.com/img/chesspieces/wikipedia/bK.png',
            'P': 'https://chessboardjs.com/img/chesspieces/wikipedia/wP.png','R': 'https://chessboardjs.com/img/chesspieces/wikipedia/wR.png','N': 'https://chessboardjs.com/img/chesspieces/wikipedia/wN.png','B': 'https://chessboardjs.com/img/chesspieces/wikipedia/wB.png','Q': 'https://chessboardjs.com/img/chesspieces/wikipedia/wQ.png','K': 'https://chessboardjs.com/img/chesspieces/wikipedia/wK.png'
        };

        function createBoard() {
            boardEl.innerHTML = '';
            for (let i = 0; i < 64; i++) {
                const r = Math.floor(i / 8), c = i % 8;
                const name = String.fromCharCode(97 + c) + (8 - r);
                const sq = document.createElement('div');
                sq.className = `square ${(r + c) % 2 === 0 ? 'light' : 'dark'}`;
                sq.dataset.square = name;
                sq.onclick = () => handleClick(name);
                boardEl.appendChild(sq);
            }
            render();
        }

        function render() {
            document.querySelectorAll('.square').forEach(sq => {
                sq.innerHTML = ''; sq.classList.remove('hint', 'selected');
                const p = game.get(sq.dataset.square);
                if (p) { const img = document.createElement('img'); img.src = pieces[p.color === 'w' ? p.type.toUpperCase() : p.type]; sq.appendChild(img); }
            });
        }

        function handleClick(sq) {
            if (game.game_over()) return;
            if (document.querySelector(`[data-square="${sq}"]`).classList.contains('hint')) {
                move(selectedSquare, sq); return;
            }
            const p = game.get(sq);
            if (p && p.color === game.turn()) {
                selectedSquare = sq; render();
                document.querySelector(`[data-square="${sq}"]`).classList.add('selected');
                game.moves({ square: sq, verbose: true }).forEach(m => document.querySelector(`[data-square="${m.to}"]`).classList.add('hint'));
            }
        }

        function move(from, to) {
            if (game.move({ from, to, promotion: 'q' })) {
                document.getElementById('moveSnd').play();
                render(); updateStatus();
                if (gameMode === 'ai' && !game.game_over()) setTimeout(aiMove, 600);
            }
        }

        function aiMove() {
            const m = game.moves();
            game.move(m[Math.floor(Math.random() * m.length)]);
            document.getElementById('moveSnd').play();
            render(); updateStatus();
        }

        function updateStatus() {
            const turn = game.turn() === 'w' ? 'Ø§Ù„Ø£Ø¨ÙŠØ¶' : 'Ø§Ù„Ø£Ø³ÙˆØ¯';
            document.getElementById('status').innerText = "Ø¯ÙˆØ±: " + turn;
            if (game.game_over()) {
                let msg = game.in_checkmate() ? (game.turn() === 'b' ? "ÙØ²Øª Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±!" : "Ø®Ø³Ø± Ø§Ù„Ø£Ø¨ÙŠØ¶!") : "ØªØ¹Ø§Ø¯Ù„!";
                if(gameMode === 'ai') updateStats(game.turn() === 'b' ? 'win' : 'loss');
                document.getElementById('overDesc').innerText = msg;
                document.getElementById('overlay').style.display = 'flex';
            }
        }

        createBoard();
    </script>
</body>
</html>
